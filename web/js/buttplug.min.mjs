/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/buttplug@3.2.2/dist/web/buttplug.mjs
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var rt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Dt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var at={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function s(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,i){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new s(r,o||e,i),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function i(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),a.prototype.eventNames=function(){var e,r,s=[];if(0===this._eventsCount)return s;for(r in e=this._events)t.call(e,r)&&s.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(e)):s},a.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,o=r.length,i=new Array(o);s<o;s++)i[s]=r[s].fn;return i},a.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},a.prototype.emit=function(e,t,r,s,o,i){var a=n?n+e:e;if(!this._events[a])return!1;var c,u,p=this._events[a],d=arguments.length;if(p.fn){switch(p.once&&this.removeListener(e,p.fn,void 0,!0),d){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,t),!0;case 3:return p.fn.call(p.context,t,r),!0;case 4:return p.fn.call(p.context,t,r,s),!0;case 5:return p.fn.call(p.context,t,r,s,o),!0;case 6:return p.fn.call(p.context,t,r,s,o,i),!0}for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];p.fn.apply(p.context,c)}else{var h,l=p.length;for(u=0;u<l;u++)switch(p[u].once&&this.removeListener(e,p[u].fn,void 0,!0),d){case 1:p[u].fn.call(p[u].context);break;case 2:p[u].fn.call(p[u].context,t);break;case 3:p[u].fn.call(p[u].context,t,r);break;case 4:p[u].fn.call(p[u].context,t,r,s);break;default:if(!c)for(h=1,c=new Array(d-1);h<d;h++)c[h-1]=arguments[h];p[u].fn.apply(p[u].context,c)}}return!0},a.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,r,s){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return i(this,o),this;var a=this._events[o];if(a.fn)a.fn===t&&(!s||a.once)&&(!r||a.context===r)&&i(this,o);else{for(var c=0,u=[],p=a.length;c<p;c++)(a[c].fn!==t||s&&!a[c].once||r&&a[c].context!==r)&&u.push(a[c]);u.length?this._events[o]=1===u.length?u[0]:u:i(this,o)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&i(this,t)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a}(at);var Nt=at.exports;const ve=Dt(Nt);
/*!
 * Buttplug JS Source Code File - Visit https://buttplug.io for more info about
 * the project. Licensed under the BSD 3-Clause license. See LICENSE file in the
 * project root for full license information.
 *
 * @copyright Copyright (c) Nonpolynomial Labs LLC. All rights reserved.
 */var ct=(e=>(e[e.Off=0]="Off",e[e.Error=1]="Error",e[e.Warn=2]="Warn",e[e.Info=3]="Info",e[e.Debug=4]="Debug",e[e.Trace=5]="Trace",e))(ct||{});class Tt{constructor(e,t){const n=new Date,r=n.getHours(),s=n.getMinutes(),o=n.getSeconds();this.timestamp=`${r}:${s}:${o}`,this.logMessage=e,this.logLevel=t}get Message(){return this.logMessage}get LogLevel(){return this.logLevel}get Timestamp(){return this.timestamp}get FormattedMessage(){return`${ct[this.logLevel]} : ${this.timestamp} : ${this.logMessage}`}}const ut=class e extends ve{constructor(){super(),this.maximumConsoleLogLevel=0,this.maximumEventLogLevel=0}static get Logger(){return void 0===e.sLogger&&(e.sLogger=new e),this.sLogger}get MaximumConsoleLogLevel(){return this.maximumConsoleLogLevel}set MaximumConsoleLogLevel(e){this.maximumConsoleLogLevel=e}get MaximumEventLogLevel(){return this.maximumEventLogLevel}set MaximumEventLogLevel(e){this.maximumEventLogLevel=e}Error(e){this.AddLogMessage(e,1)}Warn(e){this.AddLogMessage(e,2)}Info(e){this.AddLogMessage(e,3)}Debug(e){this.AddLogMessage(e,4)}Trace(e){this.AddLogMessage(e,5)}AddLogMessage(e,t){if(t>this.maximumEventLogLevel&&t>this.maximumConsoleLogLevel)return;const n=new Tt(e,t);t<=this.maximumConsoleLogLevel&&console.log(n.FormattedMessage),t<=this.maximumEventLogLevel&&this.emit("log",n)}};ut.sLogger=void 0;let Pt=ut;var b;!function(e){e[e.PLAIN_TO_CLASS=0]="PLAIN_TO_CLASS",e[e.CLASS_TO_PLAIN=1]="CLASS_TO_PLAIN",e[e.CLASS_TO_CLASS=2]="CLASS_TO_CLASS"}(b||(b={}));var kt=function(){function e(){this._typeMetadatas=new Map,this._transformMetadatas=new Map,this._exposeMetadatas=new Map,this._excludeMetadatas=new Map,this._ancestorsMap=new Map}return e.prototype.addTypeMetadata=function(e){this._typeMetadatas.has(e.target)||this._typeMetadatas.set(e.target,new Map),this._typeMetadatas.get(e.target).set(e.propertyName,e)},e.prototype.addTransformMetadata=function(e){this._transformMetadatas.has(e.target)||this._transformMetadatas.set(e.target,new Map),this._transformMetadatas.get(e.target).has(e.propertyName)||this._transformMetadatas.get(e.target).set(e.propertyName,[]),this._transformMetadatas.get(e.target).get(e.propertyName).push(e)},e.prototype.addExposeMetadata=function(e){this._exposeMetadatas.has(e.target)||this._exposeMetadatas.set(e.target,new Map),this._exposeMetadatas.get(e.target).set(e.propertyName,e)},e.prototype.addExcludeMetadata=function(e){this._excludeMetadatas.has(e.target)||this._excludeMetadatas.set(e.target,new Map),this._excludeMetadatas.get(e.target).set(e.propertyName,e)},e.prototype.findTransformMetadatas=function(e,t,n){return this.findMetadatas(this._transformMetadatas,e,t).filter((function(e){return!e.options||!0===e.options.toClassOnly&&!0===e.options.toPlainOnly||(!0===e.options.toClassOnly?n===b.CLASS_TO_CLASS||n===b.PLAIN_TO_CLASS:!0!==e.options.toPlainOnly||n===b.CLASS_TO_PLAIN)}))},e.prototype.findExcludeMetadata=function(e,t){return this.findMetadata(this._excludeMetadatas,e,t)},e.prototype.findExposeMetadata=function(e,t){return this.findMetadata(this._exposeMetadatas,e,t)},e.prototype.findExposeMetadataByCustomName=function(e,t){return this.getExposedMetadatas(e).find((function(e){return e.options&&e.options.name===t}))},e.prototype.findTypeMetadata=function(e,t){return this.findMetadata(this._typeMetadatas,e,t)},e.prototype.getStrategy=function(e){var t=this._excludeMetadatas.get(e),n=t&&t.get(void 0),r=this._exposeMetadatas.get(e),s=r&&r.get(void 0);return n&&s||!n&&!s?"none":n?"excludeAll":"exposeAll"},e.prototype.getExposedMetadatas=function(e){return this.getMetadata(this._exposeMetadatas,e)},e.prototype.getExcludedMetadatas=function(e){return this.getMetadata(this._excludeMetadatas,e)},e.prototype.getExposedProperties=function(e,t){return this.getExposedMetadatas(e).filter((function(e){return!e.options||!0===e.options.toClassOnly&&!0===e.options.toPlainOnly||(!0===e.options.toClassOnly?t===b.CLASS_TO_CLASS||t===b.PLAIN_TO_CLASS:!0!==e.options.toPlainOnly||t===b.CLASS_TO_PLAIN)})).map((function(e){return e.propertyName}))},e.prototype.getExcludedProperties=function(e,t){return this.getExcludedMetadatas(e).filter((function(e){return!e.options||!0===e.options.toClassOnly&&!0===e.options.toPlainOnly||(!0===e.options.toClassOnly?t===b.CLASS_TO_CLASS||t===b.PLAIN_TO_CLASS:!0!==e.options.toPlainOnly||t===b.CLASS_TO_PLAIN)})).map((function(e){return e.propertyName}))},e.prototype.clear=function(){this._typeMetadatas.clear(),this._exposeMetadatas.clear(),this._excludeMetadatas.clear(),this._ancestorsMap.clear()},e.prototype.getMetadata=function(e,t){var n,r=e.get(t);r&&(n=Array.from(r.values()).filter((function(e){return void 0!==e.propertyName})));for(var s=[],o=0,i=this.getAncestors(t);o<i.length;o++){var a=i[o],c=e.get(a);if(c){var u=Array.from(c.values()).filter((function(e){return void 0!==e.propertyName}));s.push.apply(s,u)}}return s.concat(n||[])},e.prototype.findMetadata=function(e,t,n){var r=e.get(t);if(r){var s=r.get(n);if(s)return s}for(var o=0,i=this.getAncestors(t);o<i.length;o++){var a=i[o],c=e.get(a);if(c){var u=c.get(n);if(u)return u}}},e.prototype.findMetadatas=function(e,t,n){var r,s=e.get(t);s&&(r=s.get(n));for(var o=[],i=0,a=this.getAncestors(t);i<a.length;i++){var c=a[i],u=e.get(c);u&&u.has(n)&&o.push.apply(o,u.get(n))}return o.slice().reverse().concat((r||[]).slice().reverse())},e.prototype.getAncestors=function(e){if(!e)return[];if(!this._ancestorsMap.has(e)){for(var t=[],n=Object.getPrototypeOf(e.prototype.constructor);typeof n.prototype<"u";n=Object.getPrototypeOf(n.prototype.constructor))t.push(n);this._ancestorsMap.set(e,t)}return this._ancestorsMap.get(e)},e}(),F=new kt;function jt(){return typeof globalThis<"u"?globalThis:typeof global<"u"?global:typeof window<"u"?window:typeof self<"u"?self:void 0}function Bt(e){return null!==e&&"object"==typeof e&&"function"==typeof e.then}var st=globalThis&&globalThis.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,s=0,o=t.length;s<o;s++)(r||!(s in t))&&(r||(r=Array.prototype.slice.call(t,0,s)),r[s]=t[s]);return e.concat(r||Array.prototype.slice.call(t))};function $t(e){var t=new e;return t instanceof Set||"push"in t?t:[]}var oe=function(){function e(e,t){this.transformationType=e,this.options=t,this.recursionStack=new Set}return e.prototype.transform=function(e,t,n,r,s,o){var i=this;if(void 0===o&&(o=0),Array.isArray(t)||t instanceof Set){var a=r&&this.transformationType===b.PLAIN_TO_CLASS?$t(r):[];return t.forEach((function(t,r){var s=e?e[r]:void 0;if(i.options.enableCircularCheck&&i.isCircular(t))i.transformationType===b.CLASS_TO_CLASS&&(a instanceof Set?a.add(t):a.push(t));else{var c=void 0;if("function"!=typeof n&&n&&n.options&&n.options.discriminator&&n.options.discriminator.property&&n.options.discriminator.subTypes){if(i.transformationType===b.PLAIN_TO_CLASS){c=n.options.discriminator.subTypes.find((function(e){return e.name===t[n.options.discriminator.property]}));var u={newObject:a,object:t,property:void 0},p=n.typeFunction(u);c=void 0===c?p:c.value,n.options.keepDiscriminatorProperty||delete t[n.options.discriminator.property]}i.transformationType===b.CLASS_TO_CLASS&&(c=t.constructor),i.transformationType===b.CLASS_TO_PLAIN&&(t[n.options.discriminator.property]=n.options.discriminator.subTypes.find((function(e){return e.value===t.constructor})).name)}else c=n;var d=i.transform(s,t,c,void 0,t instanceof Map,o+1);a instanceof Set?a.add(d):a.push(d)}})),a}if(n===String&&!s)return null==t?t:String(t);if(n===Number&&!s)return null==t?t:Number(t);if(n===Boolean&&!s)return null==t?t:!!t;if((n===Date||t instanceof Date)&&!s)return t instanceof Date?new Date(t.valueOf()):null==t?t:new Date(t);if(jt().Buffer&&(n===Buffer||t instanceof Buffer)&&!s)return null==t?t:Buffer.from(t);if(Bt(t)&&!s)return new Promise((function(e,r){t.then((function(t){return e(i.transform(void 0,t,n,void 0,void 0,o+1))}),r)}));if(!s&&null!==t&&"object"==typeof t&&"function"==typeof t.then)return t;if("object"==typeof t&&null!==t){!n&&t.constructor!==Object&&(!Array.isArray(t)&&t.constructor===Array||(n=t.constructor)),!n&&e&&(n=e.constructor),this.options.enableCircularCheck&&this.recursionStack.add(t);var c=this.getKeys(n,t,s),u=e||{};!e&&(this.transformationType===b.PLAIN_TO_CLASS||this.transformationType===b.CLASS_TO_CLASS)&&(u=s?new Map:n?new n:{});for(var p=function(r){if("__proto__"===r||"constructor"===r)return"continue";var i=r,a=r,c=r;if(!d.options.ignoreDecorators&&n)if(d.transformationType===b.PLAIN_TO_CLASS)(p=F.findExposeMetadataByCustomName(n,r))&&(c=p.propertyName,a=p.propertyName);else if(d.transformationType===b.CLASS_TO_PLAIN||d.transformationType===b.CLASS_TO_CLASS){var p;(p=F.findExposeMetadata(n,r))&&p.options&&p.options.name&&(a=p.options.name)}var h=void 0;h=d.transformationType===b.PLAIN_TO_CLASS?t[i]:t instanceof Map?t.get(i):t[i]instanceof Function?t[i]():t[i];var l=void 0,f=h instanceof Map;if(n&&s)l=n;else if(n){var g=F.findTypeMetadata(n,c);if(g){var y={newObject:u,object:t,property:c},v=g.typeFunction?g.typeFunction(y):g.reflectedType;g.options&&g.options.discriminator&&g.options.discriminator.property&&g.options.discriminator.subTypes?t[i]instanceof Array?l=g:(d.transformationType===b.PLAIN_TO_CLASS&&(l=void 0===(l=g.options.discriminator.subTypes.find((function(e){if(h&&h instanceof Object&&g.options.discriminator.property in h)return e.name===h[g.options.discriminator.property]})))?v:l.value,g.options.keepDiscriminatorProperty||h&&h instanceof Object&&g.options.discriminator.property in h&&delete h[g.options.discriminator.property]),d.transformationType===b.CLASS_TO_CLASS&&(l=h.constructor),d.transformationType===b.CLASS_TO_PLAIN&&h&&(h[g.options.discriminator.property]=g.options.discriminator.subTypes.find((function(e){return e.value===h.constructor})).name)):l=v,f=f||g.reflectedType===Map}else if(d.options.targetMaps)d.options.targetMaps.filter((function(e){return e.target===n&&!!e.properties[c]})).forEach((function(e){return l=e.properties[c]}));else if(d.options.enableImplicitConversion&&d.transformationType===b.PLAIN_TO_CLASS){var m=Reflect.getMetadata("design:type",n.prototype,c);m&&(l=m)}}var _=Array.isArray(t[i])?d.getReflectedType(n,c):void 0,w=e?e[i]:void 0;if(u.constructor.prototype){var S=Object.getOwnPropertyDescriptor(u.constructor.prototype,a);if((d.transformationType===b.PLAIN_TO_CLASS||d.transformationType===b.CLASS_TO_CLASS)&&(S&&!S.set||u[a]instanceof Function))return"continue"}if(d.options.enableCircularCheck&&d.isCircular(h)){if(d.transformationType===b.CLASS_TO_CLASS){C=h;(void 0!==(C=d.applyCustomTransformations(C,n,r,t,d.transformationType))||d.options.exposeUnsetFields)&&(u instanceof Map?u.set(a,C):u[a]=C)}}else{var x=d.transformationType===b.PLAIN_TO_CLASS?a:r,C=void 0;d.transformationType===b.CLASS_TO_PLAIN?(C=t[x],C=d.applyCustomTransformations(C,n,x,t,d.transformationType),C=t[x]===C?h:C,C=d.transform(w,C,l,_,f,o+1)):void 0===h&&d.options.exposeDefaultValues?C=u[a]:(C=d.transform(w,h,l,_,f,o+1),C=d.applyCustomTransformations(C,n,x,t,d.transformationType)),(void 0!==C||d.options.exposeUnsetFields)&&(u instanceof Map?u.set(a,C):u[a]=C)}},d=this,h=0,l=c;h<l.length;h++){p(l[h])}return this.options.enableCircularCheck&&this.recursionStack.delete(t),u}return t},e.prototype.applyCustomTransformations=function(e,t,n,r,s){var o=this,i=F.findTransformMetadatas(t,n,this.transformationType);return void 0!==this.options.version&&(i=i.filter((function(e){return!e.options||o.checkVersion(e.options.since,e.options.until)}))),(i=this.options.groups&&this.options.groups.length?i.filter((function(e){return!e.options||o.checkGroups(e.options.groups)})):i.filter((function(e){return!e.options||!e.options.groups||!e.options.groups.length}))).forEach((function(t){e=t.transformFn({value:e,key:n,obj:r,type:s,options:o.options})})),e},e.prototype.isCircular=function(e){return this.recursionStack.has(e)},e.prototype.getReflectedType=function(e,t){if(e){var n=F.findTypeMetadata(e,t);return n?n.reflectedType:void 0}},e.prototype.getKeys=function(e,t,n){var r=this,s=F.getStrategy(e);"none"===s&&(s=this.options.strategy||"exposeAll");var o=[];if(("exposeAll"===s||n)&&(o=t instanceof Map?Array.from(t.keys()):Object.keys(t)),n)return o;if(this.options.ignoreDecorators&&this.options.excludeExtraneousValues&&e){var i=F.getExposedProperties(e,this.transformationType),a=F.getExcludedProperties(e,this.transformationType);o=st(st([],i,!0),a,!0)}if(!this.options.ignoreDecorators&&e){i=F.getExposedProperties(e,this.transformationType);this.transformationType===b.PLAIN_TO_CLASS&&(i=i.map((function(t){var n=F.findExposeMetadata(e,t);return n&&n.options&&n.options.name?n.options.name:t}))),o=this.options.excludeExtraneousValues?i:o.concat(i);var c=F.getExcludedProperties(e,this.transformationType);c.length>0&&(o=o.filter((function(e){return!c.includes(e)}))),void 0!==this.options.version&&(o=o.filter((function(t){var n=F.findExposeMetadata(e,t);return!n||!n.options||r.checkVersion(n.options.since,n.options.until)}))),o=this.options.groups&&this.options.groups.length?o.filter((function(t){var n=F.findExposeMetadata(e,t);return!n||!n.options||r.checkGroups(n.options.groups)})):o.filter((function(t){var n=F.findExposeMetadata(e,t);return!(n&&n.options&&n.options.groups&&n.options.groups.length)}))}return this.options.excludePrefixes&&this.options.excludePrefixes.length&&(o=o.filter((function(e){return r.options.excludePrefixes.every((function(t){return e.substr(0,t.length)!==t}))}))),o=o.filter((function(e,t,n){return n.indexOf(e)===t}))},e.prototype.checkVersion=function(e,t){var n=!0;return n&&e&&(n=this.options.version>=e),n&&t&&(n=this.options.version<t),n},e.prototype.checkGroups=function(e){return!e||this.options.groups.some((function(t){return e.includes(t)}))},e}(),ae={enableCircularCheck:!1,enableImplicitConversion:!1,excludeExtraneousValues:!1,excludePrefixes:void 0,exposeDefaultValues:!1,exposeUnsetFields:!0,groups:void 0,ignoreDecorators:!1,strategy:void 0,targetMaps:void 0,version:void 0},G=globalThis&&globalThis.__assign||function(){return G=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},G.apply(this,arguments)},Ft=function(){function e(){}return e.prototype.instanceToPlain=function(e,t){return new oe(b.CLASS_TO_PLAIN,G(G({},ae),t)).transform(void 0,e,void 0,void 0,void 0,void 0)},e.prototype.classToPlainFromExist=function(e,t,n){return new oe(b.CLASS_TO_PLAIN,G(G({},ae),n)).transform(t,e,void 0,void 0,void 0,void 0)},e.prototype.plainToInstance=function(e,t,n){return new oe(b.PLAIN_TO_CLASS,G(G({},ae),n)).transform(void 0,t,e,void 0,void 0,void 0)},e.prototype.plainToClassFromExist=function(e,t,n){return new oe(b.PLAIN_TO_CLASS,G(G({},ae),n)).transform(e,t,void 0,void 0,void 0,void 0)},e.prototype.instanceToInstance=function(e,t){return new oe(b.CLASS_TO_CLASS,G(G({},ae),t)).transform(void 0,e,void 0,void 0,void 0,void 0)},e.prototype.classToClassFromExist=function(e,t,n){return new oe(b.CLASS_TO_CLASS,G(G({},ae),n)).transform(t,e,void 0,void 0,void 0,void 0)},e.prototype.serialize=function(e,t){return JSON.stringify(this.instanceToPlain(e,t))},e.prototype.deserialize=function(e,t,n){var r=JSON.parse(t);return this.plainToInstance(e,r,n)},e.prototype.deserializeArray=function(e,t,n){var r=JSON.parse(t);return this.plainToInstance(e,r,n)},e}();function Le(e,t){return void 0===t&&(t={}),function(n,r){var s=Reflect.getMetadata("design:type",n,r);F.addTypeMetadata({target:n.constructor,propertyName:r,reflectedType:s,typeFunction:e,options:t})}}var it,ft=new Ft;function Ut(e,t){return ft.instanceToPlain(e,t)}function Wt(e,t,n){return ft.plainToInstance(e,t,n)}
/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */!function(e){!function(t){var n="object"==typeof rt?rt:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),r=s(e);function s(e,t){return function(n,r){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}typeof n.Reflect>"u"?n.Reflect=e:r=s(n.Reflect,r),function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",s=n&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,i={__proto__:[]}instanceof Array,a=!o&&!i,c={create:o?function(){return re(Object.create(null))}:i?function(){return re({__proto__:null})}:function(){return re({})},has:a?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:a?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},u=Object.getPrototypeOf(Function),p="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,d=p||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?ee():Map,h=p||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?te():Set,l=new(p||"function"!=typeof WeakMap?ne():WeakMap);function f(e,t,n,r){if(N(n)){if(!W(e))throw new TypeError;if(!V(t))throw new TypeError;return C(e,t)}if(!W(e))throw new TypeError;if(!j(t))throw new TypeError;if(!j(r)&&!N(r)&&!k(r))throw new TypeError;return k(r)&&(r=void 0),M(e,t,n=z(n),r)}function g(e,t){function n(n,r){if(!j(n))throw new TypeError;if(!N(r)&&!H(r))throw new TypeError;I(e,t,n,r)}return n}function y(e,t,n,r){if(!j(n))throw new TypeError;return N(r)||(r=z(r)),I(e,t,n,r)}function v(e,t,n){if(!j(t))throw new TypeError;return N(n)||(n=z(n)),E(e,t,n)}function m(e,t,n){if(!j(t))throw new TypeError;return N(n)||(n=z(n)),O(e,t,n)}function _(e,t,n){if(!j(t))throw new TypeError;return N(n)||(n=z(n)),T(e,t,n)}function w(e,t,n){if(!j(t))throw new TypeError;return N(n)||(n=z(n)),L(e,t,n)}function S(e,t){if(!j(e))throw new TypeError;return N(t)||(t=z(t)),R(e,t)}function b(e,t){if(!j(e))throw new TypeError;return N(t)||(t=z(t)),D(e,t)}function x(e,t,n){if(!j(t))throw new TypeError;N(n)||(n=z(n));var r=A(t,n,!1);if(N(r)||!r.delete(e))return!1;if(r.size>0)return!0;var s=l.get(t);return s.delete(n),s.size>0||l.delete(t),!0}function C(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!N(r)&&!k(r)){if(!V(r))throw new TypeError;t=r}}return t}function M(e,t,n,r){for(var s=e.length-1;s>=0;--s){var o=(0,e[s])(t,n,r);if(!N(o)&&!k(o)){if(!j(o))throw new TypeError;r=o}}return r}function A(e,t,n){var r=l.get(e);if(N(r)){if(!n)return;r=new d,l.set(e,r)}var s=r.get(t);if(N(s)){if(!n)return;s=new d,r.set(t,s)}return s}function E(e,t,n){if(O(e,t,n))return!0;var r=Z(t);return!k(r)&&E(e,r,n)}function O(e,t,n){var r=A(t,n,!1);return!N(r)&&$(r.has(e))}function T(e,t,n){if(O(e,t,n))return L(e,t,n);var r=Z(t);return k(r)?void 0:T(e,r,n)}function L(e,t,n){var r=A(t,n,!1);if(!N(r))return r.get(e)}function I(e,t,n,r){A(n,r,!0).set(e,t)}function R(e,t){var n=D(e,t),r=Z(e);if(null===r)return n;var s=R(r,t);if(s.length<=0)return n;if(n.length<=0)return s;for(var o=new h,i=[],a=0,c=n;a<c.length;a++){var u=c[a];o.has(u)||(o.add(u),i.push(u))}for(var p=0,d=s;p<d.length;p++){u=d[p];o.has(u)||(o.add(u),i.push(u))}return i}function D(e,t){var n=[],r=A(e,t,!1);if(N(r))return n;for(var s=q(r.keys()),o=0;;){var i=X(s);if(!i)return n.length=o,n;var a=Q(i);try{n[o]=a}catch(e){try{Y(s)}finally{throw e}}o++}}function P(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function N(e){return void 0===e}function k(e){return null===e}function B(e){return"symbol"==typeof e}function j(e){return"object"==typeof e?null!==e:"function"==typeof e}function F(e,t){switch(P(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",s=K(e,r);if(void 0!==s){var o=s.call(e,n);if(j(o))throw new TypeError;return o}return U(e,"default"===n?"number":n)}function U(e,t){if("string"===t){var n=e.toString;if(J(n))if(!j(s=n.call(e)))return s;if(J(r=e.valueOf))if(!j(s=r.call(e)))return s}else{var r;if(J(r=e.valueOf))if(!j(s=r.call(e)))return s;var s,o=e.toString;if(J(o))if(!j(s=o.call(e)))return s}throw new TypeError}function $(e){return!!e}function G(e){return""+e}function z(e){var t=F(e,3);return B(t)?t:G(t)}function W(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function J(e){return"function"==typeof e}function V(e){return"function"==typeof e}function H(e){switch(P(e)){case 3:case 4:return!0;default:return!1}}function K(e,t){var n=e[t];if(null!=n){if(!J(n))throw new TypeError;return n}}function q(e){var t=K(e,s);if(!J(t))throw new TypeError;var n=t.call(e);if(!j(n))throw new TypeError;return n}function Q(e){return e.value}function X(e){var t=e.next();return!t.done&&t}function Y(e){var t=e.return;t&&t.call(e)}function Z(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===u||t!==u)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var s=r.constructor;return"function"!=typeof s||s===e?t:s}function ee(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[s]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,s=n+1;s<r;s++)this._keys[s-1]=this._keys[s],this._values[s-1]=this._values[s];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,o)},t.prototype.entries=function(){return new n(this._keys,this._values,i)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[s]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function o(e,t){return t}function i(e,t){return[e,t]}}function te(){return function(){function e(){this._map=new d}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[s]=function(){return this.keys()},e}()}function ne(){var e=16,n=c.create(),r=s();return function(){function e(){this._key=s()}return e.prototype.has=function(e){var t=o(e,!1);return void 0!==t&&c.has(t,this._key)},e.prototype.get=function(e){var t=o(e,!1);return void 0!==t?c.get(t,this._key):void 0},e.prototype.set=function(e,t){return o(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=o(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=s()},e}();function s(){var e;do{e="@@WeakMap@@"+u()}while(c.has(n,e));return n[e]=!0,e}function o(e,n){if(!t.call(e,r)){if(!n)return;Object.defineProperty(e,r,{value:c.create()})}return e[r]}function i(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function a(e){return"function"==typeof Uint8Array?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(e)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(e)):i(new Uint8Array(e),e):i(new Array(e),e)}function u(){var t=a(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",r=0;r<e;++r){var s=t[r];(4===r||6===r||8===r)&&(n+="-"),s<16&&(n+="0"),n+=s.toString(16).toLowerCase()}return n}}function re(e){return e.__=void 0,delete e.__,e}e("decorate",f),e("metadata",g),e("defineMetadata",y),e("hasMetadata",v),e("hasOwnMetadata",m),e("getMetadata",_),e("getOwnMetadata",w),e("getMetadataKeys",S),e("getOwnMetadataKeys",b),e("deleteMetadata",x)}(r)}()}(it||(it={}));var Gt=Object.defineProperty,zt=Object.getOwnPropertyDescriptor,Ie=(e,t,n,r)=>{for(var s,o=r>1?void 0:r?zt(t,n):t,i=e.length-1;i>=0;i--)(s=e[i])&&(o=(r?s(t,n,o):s(o))||o);return r&&o&&Gt(t,n,o),o};const X=0,D=1,Jt=4294967295,ge=3;class Re{constructor(e){Object.assign(this,e)}update(){var e,t,n,r,s;null==(e=this.ScalarCmd)||e.forEach(((e,t)=>e.Index=t)),null==(t=this.RotateCmd)||t.forEach(((e,t)=>e.Index=t)),null==(n=this.LinearCmd)||n.forEach(((e,t)=>e.Index=t)),null==(r=this.SensorReadCmd)||r.forEach(((e,t)=>e.Index=t)),null==(s=this.SensorSubscribeCmd)||s.forEach(((e,t)=>e.Index=t))}}var ce=(e=>(e.Unknown="Unknown",e.Vibrate="Vibrate",e.Rotate="Rotate",e.Oscillate="Oscillate",e.Constrict="Constrict",e.Inflate="Inflate",e.Position="Position",e))(ce||{}),ee=(e=>(e.Unknown="Unknown",e.Battery="Battery",e.RSSI="RSSI",e.Button="Button",e.Pressure="Pressure",e))(ee||{});class qt{constructor(e){this.Index=0,Object.assign(this,e)}}class Ht{constructor(e){this.Endpoints=e}}class Yt{constructor(e){this.Index=0,Object.assign(this,e)}}class H{constructor(e){this.Id=e}get Type(){return this.constructor}toJSON(){return JSON.stringify(this.toProtocolFormat())}toProtocolFormat(){const e={};return e[this.constructor.Name]=Ut(this),e}update(){}}class J extends H{constructor(e,t){super(t),this.DeviceIndex=e,this.Id=t}}class ue extends H{constructor(e=0){super(e),this.Id=e}}class we extends ue{constructor(e=1){super(e),this.Id=e}}we.Name="Ok";class dt extends H{constructor(e=1){super(e),this.Id=e}}dt.Name="Ping";var z=(e=>(e[e.ERROR_UNKNOWN=0]="ERROR_UNKNOWN",e[e.ERROR_INIT=1]="ERROR_INIT",e[e.ERROR_PING=2]="ERROR_PING",e[e.ERROR_MSG=3]="ERROR_MSG",e[e.ERROR_DEVICE=4]="ERROR_DEVICE",e))(z||{});let Q=class extends H{constructor(e,t=0,n=1){super(n),this.ErrorMessage=e,this.ErrorCode=t,this.Id=n}get Schemversion(){return 0}};Q.Name="Error";class De{constructor(e){Object.assign(this,e)}}Ie([Le((()=>Re))],De.prototype,"DeviceMessages",2);class Ne extends H{constructor(e,t=1){super(t),this.Devices=e,this.Id=t}update(){for(const e of this.Devices)e.DeviceMessages.update()}}Ne.Name="DeviceList",Ie([Le((()=>De))],Ne.prototype,"Devices",2);class _e extends ue{constructor(e){super(),Object.assign(this,e)}update(){this.DeviceMessages.update()}}_e.Name="DeviceAdded",Ie([Le((()=>Re))],_e.prototype,"DeviceMessages",2);class Te extends ue{constructor(e){super(),this.DeviceIndex=e}}Te.Name="DeviceRemoved";class Pe extends H{constructor(e=1){super(e),this.Id=e}}Pe.Name="RequestDeviceList";class ke extends H{constructor(e=1){super(e),this.Id=e}}ke.Name="StartScanning";class je extends H{constructor(e=1){super(e),this.Id=e}}je.Name="StopScanning";class Be extends ue{constructor(){super()}}Be.Name="ScanningFinished";class $e extends H{constructor(e,t=0,n=1){super(n),this.ClientName=e,this.MessageVersion=t,this.Id=n}}$e.Name="RequestServerInfo";class Fe extends ue{constructor(e,t,n,r=1){super(),this.MessageVersion=e,this.MaxPingTime=t,this.ServerName=n,this.Id=r}}Fe.Name="ServerInfo";class Ue extends J{constructor(e=-1,t=1){super(e,t),this.DeviceIndex=e,this.Id=t}}Ue.Name="StopDeviceCmd";class We extends H{constructor(e=1){super(e),this.Id=e}}We.Name="StopAllDevices";class Se{constructor(e){this.Index=e}}class xe extends Se{constructor(e,t,n){super(e),this.Scalar=t,this.ActuatorType=n}}class me extends J{constructor(e,t=-1,n=1){super(t,n),this.Scalars=e,this.DeviceIndex=t,this.Id=n}}me.Name="ScalarCmd";class ht extends Se{constructor(e,t,n){super(e),this.Speed=t,this.Clockwise=n}}const pt=class e extends J{constructor(e,t=-1,n=1){super(t,n),this.Rotations=e,this.DeviceIndex=t,this.Id=n}static Create(t,n){const r=new Array;let s=0;for(const[e,t]of n)r.push(new ht(s,e,t)),++s;return new e(r,t)}};pt.Name="RotateCmd";let Ae=pt;class gt extends Se{constructor(e,t,n){super(e),this.Position=t,this.Duration=n}}const mt=class e extends J{constructor(e,t=-1,n=1){super(t,n),this.Vectors=e,this.DeviceIndex=t,this.Id=n}static Create(t,n){const r=new Array;let s=0;for(const e of n)r.push(new gt(s,e[0],e[1])),++s;return new e(r,t)}};mt.Name="LinearCmd";let Ee=mt;class Ge extends J{constructor(e,t,n,r=1){super(e,r),this.DeviceIndex=e,this.SensorIndex=t,this.SensorType=n,this.Id=r}}Ge.Name="SensorReadCmd";class ze extends J{constructor(e,t,n,r,s=1){super(e,s),this.DeviceIndex=e,this.SensorIndex=t,this.SensorType=n,this.Data=r,this.Id=s}}ze.Name="SensorReading";class Je extends J{constructor(e,t,n,r,s=1){super(e,s),this.DeviceIndex=e,this.Endpoint=t,this.ExpectedLength=n,this.Timeout=r,this.Id=s}}Je.Name="RawReadCmd";class qe extends J{constructor(e,t,n,r,s=1){super(e,s),this.DeviceIndex=e,this.Endpoint=t,this.Data=n,this.WriteWithResponse=r,this.Id=s}}qe.Name="RawWriteCmd";class He extends J{constructor(e,t,n=1){super(e,n),this.DeviceIndex=e,this.Endpoint=t,this.Id=n}}He.Name="RawSubscribeCmd";class Ye extends J{constructor(e,t,n=1){super(e,n),this.DeviceIndex=e,this.Endpoint=t,this.Id=n}}Ye.Name="RawUnsubscribeCmd";class Xe extends J{constructor(e,t,n,r=1){super(e,r),this.DeviceIndex=e,this.Endpoint=t,this.Data=n,this.Id=r}}Xe.Name="RawReading";const Xt=Object.freeze(Object.defineProperty({__proto__:null,ActuatorType:ce,ButtplugDeviceMessage:J,ButtplugMessage:H,ButtplugSystemMessage:ue,DEFAULT_MESSAGE_ID:1,DeviceAdded:_e,DeviceInfo:De,DeviceList:Ne,DeviceRemoved:Te,Error:Q,ErrorClass:z,GenericDeviceMessageAttributes:qt,GenericMessageSubcommand:Se,LinearCmd:Ee,MAX_ID:Jt,MESSAGE_SPEC_VERSION:3,MessageAttributes:Re,Ok:we,Ping:dt,RawDeviceMessageAttributes:Ht,RawReadCmd:Je,RawReading:Xe,RawSubscribeCmd:He,RawUnsubscribeCmd:Ye,RawWriteCmd:qe,RequestDeviceList:Pe,RequestServerInfo:$e,RotateCmd:Ae,RotateSubcommand:ht,SYSTEM_MESSAGE_ID:0,ScalarCmd:me,ScalarSubcommand:xe,ScanningFinished:Be,SensorDeviceMessageAttributes:Yt,SensorReadCmd:Ge,SensorReading:ze,SensorType:ee,ServerInfo:Fe,StartScanning:ke,StopAllDevices:We,StopDeviceCmd:Ue,StopScanning:je,VectorSubcommand:gt},Symbol.toStringTag,{value:"Module"}));
/*!
 * Buttplug JS Source Code File - Visit https://buttplug.io for more info about
 * the project. Licensed under the BSD 3-Clause license. See LICENSE file in the
 * project root for full license information.
 *
 * @copyright Copyright (c) Nonpolynomial Labs LLC. All rights reserved.
 */class U extends Error{constructor(e,t,n=0,r){super(e),this.errorClass=z.ERROR_UNKNOWN,this.errorClass=t,this.innerError=r,this.messageId=n}get ErrorClass(){return this.errorClass}get InnerError(){return this.innerError}get Id(){return this.messageId}get ErrorMessage(){return new Q(this.message,this.ErrorClass,this.Id)}static LogAndError(e,t,n,r=0){return t.Error(n),new e(n,r)}static FromError(e){switch(e.ErrorCode){case z.ERROR_DEVICE:return new P(e.ErrorMessage,e.Id);case z.ERROR_INIT:return new Oe(e.ErrorMessage,e.Id);case z.ERROR_UNKNOWN:return new Qt(e.ErrorMessage,e.Id);case z.ERROR_PING:return new Zt(e.ErrorMessage,e.Id);case z.ERROR_MSG:return new de(e.ErrorMessage,e.Id);default:throw new Error(`Message type ${e.ErrorCode} not handled`)}}}class Oe extends U{constructor(e,t=0){super(e,z.ERROR_INIT,t)}}class P extends U{constructor(e,t=0){super(e,z.ERROR_DEVICE,t)}}class de extends U{constructor(e,t=0){super(e,z.ERROR_MSG,t)}}class Zt extends U{constructor(e,t=0){super(e,z.ERROR_PING,t)}}class Qt extends U{constructor(e,t=0){super(e,z.ERROR_UNKNOWN,t)}}function vt(e){for(const t of Object.values(Xt))if("function"==typeof t&&"Name"in t&&t.Name===e)return t;return null}function ne(e){return vt(Object.getPrototypeOf(e).constructor.Name)}function ot(e){const t=JSON.parse(e),n=[];for(const e of Array.from(t)){const t=Object.getOwnPropertyNames(e)[0],r=vt(t);if(r){const s=Wt(r,e[t]);s.update(),n.push(s)}}return n}class ye extends ve{constructor(e,t){super(),this._deviceInfo=e,this._sendClosure=t,this.allowedMsgs=new Map,e.DeviceMessages.update()}get name(){return this._deviceInfo.DeviceName}get displayName(){return this._deviceInfo.DeviceDisplayName}get index(){return this._deviceInfo.DeviceIndex}get messageTimingGap(){return this._deviceInfo.DeviceMessageTimingGap}get messageAttributes(){return this._deviceInfo.DeviceMessages}static fromMsg(e,t){return new ye(e,t)}async send(e){return await this._sendClosure(this,e)}async sendExpectOk(e){const t=await this.send(e);switch(ne(t)){case we:return;case Q:throw U.FromError(t);default:throw new de(`Message type ${t.constructor} not handled by SendMsgExpectOk`)}}async scalar(e){Array.isArray(e)?await this.sendExpectOk(new me(e,this.index)):await this.sendExpectOk(new me([e],this.index))}async scalarCommandBuilder(e,t){var n;const r=null==(n=this.messageAttributes.ScalarCmd)?void 0:n.filter((e=>e.ActuatorType===t));if(!r||0===r.length)throw new P(`Device ${this.name} has no ${t} capabilities`);const s=[];if("number"==typeof e)r.forEach((n=>s.push(new xe(n.Index,e,t))));else{if(!Array.isArray(e))throw new P(`${t} can only take numbers or arrays of numbers.`);if(e.length>r.length)throw new P(`${e.length} commands send to a device with ${r.length} vibrators`);r.forEach(((n,r)=>{s.push(new xe(n.Index,e[r],t))}))}await this.scalar(s)}get vibrateAttributes(){var e;return(null==(e=this.messageAttributes.ScalarCmd)?void 0:e.filter((e=>e.ActuatorType===ce.Vibrate)))??[]}async vibrate(e){await this.scalarCommandBuilder(e,ce.Vibrate)}get oscillateAttributes(){var e;return(null==(e=this.messageAttributes.ScalarCmd)?void 0:e.filter((e=>e.ActuatorType===ce.Oscillate)))??[]}async oscillate(e){await this.scalarCommandBuilder(e,ce.Oscillate)}get rotateAttributes(){return this.messageAttributes.RotateCmd??[]}async rotate(e,t){const n=this.messageAttributes.RotateCmd;if(!n||0===n.length)throw new P(`Device ${this.name} has no Rotate capabilities`);let r;if("number"==typeof e)r=Ae.Create(this.index,new Array(n.length).fill([e,t]));else{if(!Array.isArray(e))throw new P("SendRotateCmd can only take a number and boolean, or an array of number/boolean tuples");r=Ae.Create(this.index,e)}await this.sendExpectOk(r)}get linearAttributes(){return this.messageAttributes.LinearCmd??[]}async linear(e,t){const n=this.messageAttributes.LinearCmd;if(!n||0===n.length)throw new P(`Device ${this.name} has no Linear capabilities`);let r;if("number"==typeof e)r=Ee.Create(this.index,new Array(n.length).fill([e,t]));else{if(!Array.isArray(e))throw new P("SendLinearCmd can only take a number and number, or an array of number/number tuples");r=Ee.Create(this.index,e)}await this.sendExpectOk(r)}async sensorRead(e,t){const n=await this.send(new Ge(this.index,e,t));switch(ne(n)){case ze:return n.Data;case Q:throw U.FromError(n);default:throw new de(`Message type ${n.constructor} not handled by sensorRead`)}}get hasBattery(){var e;const t=null==(e=this.messageAttributes.SensorReadCmd)?void 0:e.filter((e=>e.SensorType===ee.Battery));return void 0!==t&&t.length>0}async battery(){var e;if(!this.hasBattery)throw new P(`Device ${this.name} has no Battery capabilities`);const t=null==(e=this.messageAttributes.SensorReadCmd)?void 0:e.filter((e=>e.SensorType===ee.Battery));return(await this.sensorRead(t[0].Index,ee.Battery))[0]/100}get hasRssi(){var e;const t=null==(e=this.messageAttributes.SensorReadCmd)?void 0:e.filter((e=>e.SensorType===ee.RSSI));return void 0!==t&&0===t.length}async rssi(){var e;if(!this.hasRssi)throw new P(`Device ${this.name} has no RSSI capabilities`);const t=null==(e=this.messageAttributes.SensorReadCmd)?void 0:e.filter((e=>e.SensorType===ee.RSSI));return(await this.sensorRead(t[0].Index,ee.RSSI))[0]}async rawRead(e,t,n){if(!this.messageAttributes.RawReadCmd)throw new P(`Device ${this.name} has no raw read capabilities`);if(-1===this.messageAttributes.RawReadCmd.Endpoints.indexOf(e))throw new P(`Device ${this.name} has no raw readable endpoint ${e}`);const r=await this.send(new Je(this.index,e,t,n));switch(ne(r)){case Xe:return new Uint8Array(r.Data);case Q:throw U.FromError(r);default:throw new de(`Message type ${r.constructor} not handled by rawRead`)}}async rawWrite(e,t,n){if(!this.messageAttributes.RawWriteCmd)throw new P(`Device ${this.name} has no raw write capabilities`);if(-1===this.messageAttributes.RawWriteCmd.Endpoints.indexOf(e))throw new P(`Device ${this.name} has no raw writable endpoint ${e}`);await this.sendExpectOk(new qe(this.index,e,t,n))}async rawSubscribe(e){if(!this.messageAttributes.RawSubscribeCmd)throw new P(`Device ${this.name} has no raw subscribe capabilities`);if(-1===this.messageAttributes.RawSubscribeCmd.Endpoints.indexOf(e))throw new P(`Device ${this.name} has no raw subscribable endpoint ${e}`);await this.sendExpectOk(new He(this.index,e))}async rawUnsubscribe(e){if(!this.messageAttributes.RawSubscribeCmd)throw new P(`Device ${this.name} has no raw unsubscribe capabilities`);if(-1===this.messageAttributes.RawSubscribeCmd.Endpoints.indexOf(e))throw new P(`Device ${this.name} has no raw unsubscribable endpoint ${e}`);await this.sendExpectOk(new Ye(this.index,e))}async stop(){await this.sendExpectOk(new Ue(this.index))}emitDisconnected(){this.emit("deviceremoved")}}
/*!
 * Buttplug JS Source Code File - Visit https://buttplug.io for more info about
 * the project. Licensed under the BSD 3-Clause license. See LICENSE file in the
 * project root for full license information.
 *
 * @copyright Copyright (c) Nonpolynomial Labs LLC. All rights reserved.
 */class Kt{constructor(e){this._useCounter=e,this._counter=1,this._waitingMsgs=new Map}PrepareOutgoingMessage(e){let t,n;this._useCounter&&(e.Id=this._counter,this._counter+=1);const r=new Promise(((e,r)=>{t=e,n=r}));return this._waitingMsgs.set(e.Id,[t,n]),r}ParseIncomingMessages(e){const t=[];for(const n of e){if(0!==n.Id&&this._waitingMsgs.has(n.Id)){const[e,t]=this._waitingMsgs.get(n.Id);if(n.Type===Q){t(U.FromError(n));continue}e(n);continue}t.push(n)}return t}}
/*!
 * Buttplug JS Source Code File - Visit https://buttplug.io for more info about
 * the project. Licensed under the BSD 3-Clause license. See LICENSE file in the
 * project root for full license information.
 *
 * @copyright Copyright (c) Nonpolynomial Labs LLC. All rights reserved.
 */class Vt extends U{constructor(e){super(e,z.ERROR_UNKNOWN)}}class sn extends ve{constructor(e="Generic Buttplug Client"){super(),this._pingTimer=null,this._connector=null,this._devices=new Map,this._logger=Pt.Logger,this._isScanning=!1,this._sorter=new Kt(!0),this.connect=async e=>{this._logger.Info(`ButtplugClient: Connecting using ${e.constructor.name}`),await e.connect(),this._connector=e,this._connector.addListener("message",this.parseMessages),this._connector.addListener("disconnect",this.disconnectHandler),await this.initializeConnection()},this.disconnect=async()=>{this._logger.Debug("ButtplugClient: Disconnect called"),this.checkConnector(),await this.shutdownConnection(),await this._connector.disconnect()},this.startScanning=async()=>{this._logger.Debug("ButtplugClient: StartScanning called"),this._isScanning=!0,await this.sendMsgExpectOk(new ke)},this.stopScanning=async()=>{this._logger.Debug("ButtplugClient: StopScanning called"),this._isScanning=!1,await this.sendMsgExpectOk(new je)},this.stopAllDevices=async()=>{this._logger.Debug("ButtplugClient: StopAllDevices"),await this.sendMsgExpectOk(new We)},this.disconnectHandler=()=>{this._logger.Info("ButtplugClient: Disconnect event receieved."),this.emit("disconnect")},this.parseMessages=e=>{const t=this._sorter.ParseIncomingMessages(e);for(const e of t)switch(ne(e)){case _e:{const t=e,n=ye.fromMsg(t,this.sendDeviceMessageClosure);this._devices.set(t.DeviceIndex,n),this.emit("deviceadded",n);break}case Te:{const t=e;if(this._devices.has(t.DeviceIndex)){const e=this._devices.get(t.DeviceIndex);null==e||e.emitDisconnected(),this._devices.delete(t.DeviceIndex),this.emit("deviceremoved",e)}break}case Be:this._isScanning=!1,this.emit("scanningfinished",e)}},this.initializeConnection=async()=>{this.checkConnector();const e=await this.sendMessage(new $e(this._clientName,3));switch(ne(e)){case Fe:{const t=e;if(this._logger.Info(`ButtplugClient: Connected to Server ${t.ServerName}`),t.MaxPingTime,t.MessageVersion<3)throw await this._connector.disconnect(),U.LogAndError(Oe,this._logger,`Server protocol version ${t.MessageVersion} is older than client protocol version 3. Please update server.`);return await this.requestDeviceList(),!0}case Q:{await this._connector.disconnect();const t=e;throw U.LogAndError(Oe,this._logger,`Cannot connect to server. ${t.ErrorMessage}`)}}return!1},this.requestDeviceList=async()=>{this.checkConnector(),this._logger.Debug("ButtplugClient: ReceiveDeviceList called"),(await this.sendMessage(new Pe)).Devices.forEach((e=>{if(this._devices.has(e.DeviceIndex))this._logger.Debug(`ButtplugClient: Device already added: ${e}`);else{const t=ye.fromMsg(e,this.sendDeviceMessageClosure);this._logger.Debug(`ButtplugClient: Adding Device: ${t}`),this._devices.set(e.DeviceIndex,t),this.emit("deviceadded",t)}}))},this.shutdownConnection=async()=>{await this.stopAllDevices(),null!==this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=null)},this.sendMsgExpectOk=async e=>{const t=await this.sendMessage(e);switch(ne(t)){case we:return;case Q:throw U.FromError(t);default:throw U.LogAndError(de,this._logger,`Message type ${ne(t).constructor} not handled by SendMsgExpectOk`)}},this.sendDeviceMessageClosure=async(e,t)=>await this.sendDeviceMessage(e,t),this._clientName=e,this._logger.Debug(`ButtplugClient: Client ${e} created.`)}get connected(){return null!==this._connector&&this._connector.Connected}get devices(){this.checkConnector();const e=[];return this._devices.forEach((t=>{e.push(t)})),e}get isScanning(){return this._isScanning}async sendDeviceMessage(e,t){if(this.checkConnector(),void 0===this._devices.get(e.index))throw U.LogAndError(P,this._logger,`Device ${e.index} not available.`);return t.DeviceIndex=e.index,await this.sendMessage(t)}async sendMessage(e){this.checkConnector();const t=this._sorter.PrepareOutgoingMessage(e);return await this._connector.send(e),await t}checkConnector(){if(!this.connected)throw new Vt("ButtplugClient not connected")}}class en extends ve{constructor(e){super(),this._url=e,this._websocketConstructor=null,this.connect=async()=>{const e=new(this._websocketConstructor??WebSocket)(this._url);let t,n;const r=new Promise(((e,r)=>{t=e,n=r})),s=()=>n();return e.addEventListener("open",(async()=>{this._ws=e;try{await this.initialize(),this._ws.addEventListener("message",(e=>{this.parseIncomingMessage(e)})),this._ws.removeEventListener("close",s),this._ws.addEventListener("close",this.disconnect),t()}catch(e){console.log(e),n()}})),e.addEventListener("close",s),r},this.disconnect=async()=>{this.Connected&&(this._ws.close(),this._ws=void 0,this.emit("disconnect"))},this.initialize=async()=>Promise.resolve()}get Connected(){return void 0!==this._ws}sendMessage(e){if(!this.Connected)throw new Error("ButtplugBrowserWebsocketConnector not connected");this._ws.send("["+e.toJSON()+"]")}parseIncomingMessage(e){if("string"==typeof e.data){const t=ot(e.data);this.emit("message",t)}else e.data,Blob}onReaderLoad(e){const t=ot(e.target.result);this.emit("message",t)}}class tn extends en{constructor(){super(...arguments),this.send=e=>{if(!this.Connected)throw new Error("ButtplugClient not connected");this.sendMessage(e)}}}var nn=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")};class on extends tn{constructor(){super(...arguments),this._websocketConstructor=nn.WebSocket}}export{ce as ActuatorType,tn as ButtplugBrowserWebsocketClientConnector,sn as ButtplugClient,Vt as ButtplugClientConnectorException,ye as ButtplugClientDevice,P as ButtplugDeviceError,J as ButtplugDeviceMessage,U as ButtplugError,Oe as ButtplugInitError,ct as ButtplugLogLevel,Pt as ButtplugLogger,H as ButtplugMessage,de as ButtplugMessageError,Kt as ButtplugMessageSorter,on as ButtplugNodeWebsocketClientConnector,Zt as ButtplugPingError,ue as ButtplugSystemMessage,Qt as ButtplugUnknownError,D as DEFAULT_MESSAGE_ID,_e as DeviceAdded,De as DeviceInfo,Ne as DeviceList,Te as DeviceRemoved,Q as Error,z as ErrorClass,qt as GenericDeviceMessageAttributes,Se as GenericMessageSubcommand,Ee as LinearCmd,Tt as LogMessage,Jt as MAX_ID,ge as MESSAGE_SPEC_VERSION,Re as MessageAttributes,we as Ok,dt as Ping,Ht as RawDeviceMessageAttributes,Je as RawReadCmd,Xe as RawReading,He as RawSubscribeCmd,Ye as RawUnsubscribeCmd,qe as RawWriteCmd,Pe as RequestDeviceList,$e as RequestServerInfo,Ae as RotateCmd,ht as RotateSubcommand,X as SYSTEM_MESSAGE_ID,me as ScalarCmd,xe as ScalarSubcommand,Be as ScanningFinished,Yt as SensorDeviceMessageAttributes,Ge as SensorReadCmd,ze as SensorReading,ee as SensorType,Fe as ServerInfo,ke as StartScanning,We as StopAllDevices,Ue as StopDeviceCmd,je as StopScanning,gt as VectorSubcommand,ot as fromJSON,ne as getMessageClassFromMessage};
//# sourceMappingURL=/sm/a9ae71041ea1231e9275cea313be6d776f70c8580d2f8cf11c0a2d87f60fedc3.map